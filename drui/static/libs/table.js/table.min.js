/*!
  * table.js v0.1.0
  * Copyright 2025 by PxlFx (Sergey Zezyulin)
  * Licensed under MIT
  */
"use strict";class Table{constructor(t){t="object"==typeof t?t:{},this.version="0.1.0",this.element=t.element,this.raw=t.data,this.data=t.data,this.headers=t.headers,this.height=t.height,this.className=t.className||"",this.theadClassName=t.theadClassName||"",this.espClassName=t.espClassName||"",this.undefined_headers=!!t.undefined_headers,this.empty=t.empty||"----",this.values_text="(values)",this.redraw_bind=t.redraw_bind,this.sticky=!!t.sticky,this.esp=!!t.esp,this.filter=t.filter,this.sort=!!t.sort,this.sort_direction=!0,this.sort_index=void 0,this.index_by=t.index_by,this.indexed=!1,this.selected=this._load_state().selected||[],this.limit=t.limit,this.range={start:0,end:this.data.length>this.limit?this.limit:this.data.length},this.range=(this.limit,this.range),this.links={thead_table:null,tbody_table:null,extra_settings_panel:null,column_toggle:null,selected:null},window.Table.push(this)}is_display(t){return!this.headers||(Array.isArray(this.headers)?!(!1===this.headers[t].display||!Object.keys(this.headers).hasOwnProperty(t)):!1!==this.headers[t].display)}view(){let t=this.element;if(!t||t.nodeType!==Node.ELEMENT_NODE)return console.error("Table container is not a HTMLElement."),!1;for(;t.firstChild;)t.removeChild(t.firstChild);Array.isArray(this.data)||(this.data=[this.data]),t.table=this,t.classList.add("vanillajs-table"),this.links.thead_table=document.createElement("div"),this.links.tbody_table=document.createElement("div"),this.links.extra_settings_panel=document.createElement("div"),this.links.extra_toggle=document.createElement("div"),this.links.extra_filter=document.createElement("div"),this.links.extra_selected=document.createElement("div"),this.links.extra_pages=document.createElement("div"),(this.esp||this.limit||this.filter)&&this.extraSettingsPanel(),this.dataTable()}extraSettingsPanel(){let t=document.createElement("div");t.className="vanillajs-table-extra-settings-panel "+this.espClassName,this.links.extra_settings_panel=t,this.links.extra_toggle=this.extraToggle(),this.links.extra_toggle&&this.links.extra_toggle.remove(),t.appendChild(this.links.extra_toggle),this.links.extra_filter=this.extraFilter(),this.links.extra_filter&&this.links.extra_filter.remove(),t.appendChild(this.links.extra_filter),this.links.extra_selected=this.extraSelected(),this.links.extra_selected&&this.links.extra_selected.remove(),t.appendChild(this.links.extra_selected),this.links.extra_pages=this.extraPages(),this.links.extra_pages&&this.links.extra_pages.remove(),t.appendChild(this.links.extra_pages),this.element.appendChild(t)}extraFilter(){let t=document.createElement("input");return t.placeholder="filter",t.className="form-control form-control-sm",t.style.display=this.filter?"inline":"none",t.style.width="200px",t.onkeyup=t=>{this.data=this._filter(t.currentTarget.value),this.dataTable(),this.links.extra_pages.remove(),this.links.extra_pages=this.extraPages(),this.links.extra_settings_panel.appendChild(this.links.extra_pages)},t}_filter(t){return this.raw.filter(e=>{let i=RegExp(t,"i");for(let s=0;s<e.length;s++)if(e[s].search(i)>-1)return!0;return!1})}extraSelected(){let t=document.createElement("div");t.textContent=`${this.selected.length} selected`,t.style.display=this.selected.length?"block":"none",t.tabIndex=1,t.onfocus=()=>this._context_menu({data:()=>this.selected.map(t=>({id:t,text:t,checked:!0})),bind:t=>{this.selected=[],t.forEach(t=>{t.checked&&this.selected.push(t.text)})},link:this.links.selected}),t.className="vanillajs-table-link";let e=document.createElement("div");return e.className="vanillajs-table-group",e.style.marginLeft="1rem",this.links.selected=e,e.appendChild(t),e}extraToggle(){let t=document.createElement("div");t.className="vanillajs-table-group";let e=document.createElement("button");return e.textContent="â˜°",e.onfocus=()=>this._context_menu({data:()=>this._get_headers().map(t=>({id:t.id,text:t.text,checked:t.display})),bind:t=>{t.forEach(t=>{this.headers[t.text].display=t.checked})},link:t}),e.className="vanillajs-table-button",t.appendChild(e),t}extraPages(){let t=this.data.length?this.range.start+1:0,e=document.createElement("div");e.className="vanillajs-table-text",e.textContent=`showing ${t} to ${this.range.end} of ${this.data.length} entries`;let i=document.createElement("div");if(i.className="vanillajs-table-group",this.limit){let s=document.createElement("button");s.textContent="<",s.onclick=()=>this._previous(),s.className="vanillajs-table-button",s.style.marginLeft="1rem",i.appendChild(s);let a=this.range.start/this.limit+1,l=document.createElement("button");l.textContent=a.toString(),l.className="vanillajs-table-text",l.style.minWidth="30px",l.style.cursor="pointer",l.onfocus=()=>this._context_menu({data:()=>this._get_pages().map(t=>({id:t,text:`page ${t}`,checked:l.textContent===t.toString()})),bind:t=>{let e;t.forEach(t=>{t.checked&&(e=parseInt(t.text)-1)}),this.range.start=e*this.limit,this.range.end=this.range.start+this.limit,this.range.end=this.range.end>this.data.length?this.data.length:this.range.end,this.dataTable()},radio:!0,link:i}),i.appendChild(l);let n=document.createElement("button");n.textContent=">",n.onclick=()=>this._next(),n.className="vanillajs-table-button",i.appendChild(n)}let h=document.createElement("div");return h.style.float="right",h.appendChild(e),h.appendChild(i),h}dataTable(){let t=this.element,e=t.table,i=!1,s={};this.data.forEach(function(t){if("object"==typeof t)for(let a in t)!t.hasOwnProperty(a)||a in s||(s[a]={});else s[0]={name:e.values_text},i=!0}),this.headers&&(Boolean(this.undefined_headers)?Object.assign(s,this.headers):s=this.headers);let a=this.data[0],l=a&&a.hasOwnProperty(this.index_by)||!this.data.length;if(!this.indexed&&void 0!==this.index_by&&l){let n=this.index_by;this.data.forEach(function(t){void 0!==t[n]&&(Array.isArray(t)?t.splice(0,0,t[n]):t[0]=t[n])});let h={name:()=>this._custom_checkbox("select_all",!0),format:t=>this._custom_checkbox(t),width:40,system:!0};Array.isArray(this.headers)?this.headers.splice(0,0,h):this.headers[0]=h,this.indexed=!0,this.theadClassName+=" vanillajs-table-indexed"}let r=this._load_state().headers||[];try{r.forEach(t=>s[t.id].display=t.display)}catch{this._save_state()}let d=document.createElement("table"),o=document.createElement("thead"),c=o.appendChild(document.createElement("tr"));for(let p in s)if(s.hasOwnProperty(p)){let g=document.createElement("th"),m="name"in s[p]?s[p].name:p;"function"==typeof m&&(m=m()),p=this._isNumeric(p)?parseFloat(p):p,e.sort&&(g.classList.add("sorting"),e.sort_index===p&&g.classList.add(e.sort_direction?"decrease":"increase")),m.nodeName?g.appendChild(m):g.innerHTML=m,g.setAttribute("data-title",p),s[p].text=g.textContent,e.sort&&g.addEventListener("click",()=>e.sorting(p)),this.is_display(p)&&c.appendChild(g)}d.appendChild(o),o.className=d.className="vanillajs-table-header "+this.theadClassName,t.appendChild(d),this.links.thead_table&&this.links.thead_table.remove(),this.links.thead_table=d;let u=document.createElement("style"),b=document.createTextNode(".vanillajs-table td { box-sizing: border-box; }");u.appendChild(b),document.head.appendChild(u);let x=document.createElement("table");x.className=this.className;let f=document.createElement("tbody"),y=o.cloneNode(!0);y.style.visibility="collapse",y.firstChild.childNodes.forEach(t=>{let e=document.createElement("div");t.style.height=e.style.height="0",t.style.padding=e.style.padding="0",t.style.borderTop=e.style.borderTop="0",t.style.borderBottom=e.style.borderBottom="0",e.innerHTML=t.innerHTML,t.innerHTML=e.outerHTML}),x.appendChild(y);let k=this.data.slice(this.range.start,this.range.end);if(k.forEach(function(t){let a=f.appendChild(document.createElement("tr")),l;for(let n in s){if(!s.hasOwnProperty(n)||!e.is_display(n))continue;let h=this.empty,r=s[n];"object"==typeof t?[void 0,null].includes(t[n])||(h="format"in r&&"function"==typeof r.format?r.format(t[n],t):[void 0,null].includes(t[n])?h:t[n]):i&&(h=t),l=a.appendChild(document.createElement("td")),"object"!=typeof(h=void 0===h?this.empty:h)||Array.isArray(h)?l.innerHTML=h:l.appendChild(h),l.setAttribute("data-title",s[n].text),r.className&&(l.className=r.className)}},this),!this.data.length){let v=document.createElement("tr"),C=document.createElement("td");C.textContent="no data available in table",C.style.textAlign="center",C.colSpan=o.firstChild.childNodes.length,v.appendChild(C),f.appendChild(v)}let $=document.createElement("div");if($.className="vanillajs-table-data",this.height&&($.style.overflow="auto"),this.height){let E="function"==typeof this.height,N=parseFloat(E?this.height():this.height);$.style.maxHeight=N+"px"}x.appendChild(f),$.appendChild(x),t.appendChild($),this.links.tbody_table&&this.links.tbody_table.remove(),this.links.tbody_table=x,this.sticky&&this._set_sticky(),t.resize=this.resize,t.clear_width_attribute=this.clear_width_attribute,t.resize(),this.redraw_bind&&"function"==typeof this.redraw_bind&&this.redraw_bind(e)}_previous(){return!!this.limit&&(this.range.start=this.range.start>this.limit?this.range.start-this.limit:0,this.range.end=this.range.start+this.limit,this.range.end=this.range.end>this.data.length?this.data.length:this.range.end,this.links.extra_pages.remove(),this.links.extra_pages=this.extraPages(),this.links.extra_settings_panel.appendChild(this.links.extra_pages),this.dataTable(),!0)}_next(){return!!this.limit&&!(this.range.start+this.limit>=this.data.length)&&(this.range.start+=this.limit,this.range.start=this.range.start>this.data.length?this.data.length-1:this.range.start,this.range.end=this.range.start+this.limit,this.range.end=this.range.end>this.data.length?this.data.length:this.range.end,this.links.extra_pages.remove(),this.links.extra_pages=this.extraPages(),this.links.extra_settings_panel.appendChild(this.links.extra_pages),this.dataTable(),!0)}_get_pages(){let t=[];for(let e=0;e<this.data.length/this.limit;e++)t.push(e+1);return t}_get_headers(){let t=[];return Array.isArray(this.headers)?this.headers.forEach(function(e,i){if(e.system)return!1;t.push({display:!e.hasOwnProperty("display")||e.display,text:e.text,id:i})}):Object.entries(this.headers).forEach(function(e){let[i,s]=e;if(s.system)return!1;t.push({display:!s.hasOwnProperty("display")||s.display,text:s.hasOwnProperty("text")?s.text:i,id:i})}),t}_context_menu(t){let e=document.createElement("div"),i=document.createElement("div");t.data().sort().forEach(function(e){let s=document.createElement("div"),a=String(Math.random()),l=document.createElement("input");l.type=t.radio?"radio":"checkbox",l.checked=e.checked,l.value=e.id,l.id=a,l.name="_context_menu_item",l.className="form-check-input";let n=document.createElement("label");n.textContent=e.text,n.htmlFor=a,s.appendChild(l),s.appendChild(n),i.appendChild(s)}),i.style.maxHeight="200px",i.style.overflow="auto",e.appendChild(i);let s=document.createElement("button");s.textContent="save",s.className="vanillajs-table-button",s.style.marginTop="10px",s.style.width="100%",s.onclick=()=>{let i=e.getElementsByTagName("input"),s=[];for(let a=0;a<i.length;a++)s.push({text:i[a].value,checked:i[a].checked});t.bind(s),this._save_state(),this.dataTable()},e.appendChild(s),e.className="vanillajs-table-extra-list",e.tabIndex=-1,e.addEventListener("focusout",function(t){t.relatedTarget&&t.relatedTarget.offsetParent===e?t.target.focus():e.remove()}),t.link.appendChild(e),e.getBoundingClientRect().right>window.innerWidth&&(e.style.right="0"),e.focus()}_save_state(){if(!this.element.id)return console.warn("table.js: Can`t store table state. Element have not ID attribute."),!1;let t=`table.js::${location.pathname}::${this.element.id}`;return localStorage.setItem(t,JSON.stringify({headers:this._get_headers(),selected:this.selected})),!0}_load_state(){if(!this.element.id)return!1;let t=`table.js::${location.pathname}::${this.element.id}`;return JSON.parse(localStorage.getItem(t))||{}}_custom_checkbox(t,e=!1){let i=document.createElement("input");return i.type="checkbox",i.className="form-check-input",i.value=t,i.checked=-1!==this.selected.indexOf(t),e&&this.selected.length&&(this.selected.length===this.data.length?i.checked=!0:i.indeterminate=!0),i.addEventListener("click",t=>{let i=t.target.value,s=t.target.checked;s?e?(this.selected=[],this.data.forEach(t=>this.selected.push(t[0])),this.dataTable()):this.selected.push(i):e?(this.selected=[],this.dataTable()):this.selected.splice(this.selected.indexOf(i),1),this.links.selected&&(this.links.selected.firstChild.innerText=`${this.selected.length} selected`,this.links.selected.firstChild.style.display=this.selected.length?"block":"none"),this._save_state()}),i}_set_sticky(){let t=document.getElementsByTagName("html")[0].scrollTop,e=this.links.extra_settings_panel;if(e){let i=e.getBoundingClientRect();e.style.position="sticky",e.style.top=`${t+i.top}px`}let s=this.links.thead_table,a=s.getBoundingClientRect();s.style.position="sticky",s.style.top=`${t+a.top}px`}sorting(t){if(this.indexed&&0===t)return!1;this.sort_direction=this.sort_index===t&&!this.sort_direction,this.sort_index=t,this.data=this._sorting(this.data,t,this.sort_direction),this.dataTable()}clear_width_attribute(){let t=this.table;if(!t.links.tbody_table.rows.length)return!1;let e=t.links.thead_table.rows[0].childNodes,i=t.links.tbody_table.rows[0].childNodes;t.links.thead_table.style.width="";for(let s=0;s<e.length;s++)e[s].style.width=i[s].style.width=""}resize(){let t=this.table;if(!t.links.tbody_table.rows.length)return!1;let e="function"==typeof t.height,i=parseFloat(e?t.height():t.height);t.links.tbody_table.parentNode.style.maxHeight=i+"px";let s=t.headers,a=t.links.thead_table.rows[0].childNodes,l=t.links.tbody_table.rows[0].childNodes;this.clear_width_attribute();for(let n=0;n<a.length;n++){let h=a[n].getAttribute("data-title"),r=l[n].offsetWidth;if(h in s&&"width"in s[h]){let d=s[h].width;(r/d>.2||"auto"===d)&&(r=d)}l[n].style.width="auto"===r?r:r+"px"}let o=t.links.tbody_table.offsetWidth;t.links.thead_table.style.width=o+"px";for(let c=0;c<a.length;c++)a[c].style.width=l[c].offsetWidth+"px"}_sorting(t,e,i){let s=this;return t.sort(function(t,a){let l,n,h=1;return(l=s._isNumeric(t[e])?parseInt(t[e]):t[e],n=s._isNumeric(a[e])?parseInt(a[e]):a[e],i&&(h=-1),l>n)?h:l<n?-h:0}),t}_isNumeric(t){let e=typeof t;return("number"===e||"string"===e)&&!isNaN(t-parseFloat(t))}}!function(){let t=0;window.onresize=function(){clearTimeout(t),t=setTimeout(function(){let t=document.getElementsByClassName("vanillajs-table");if(t.length>1)for(let e=0;e<t.length;e++)t[e].clear_width_attribute();for(let i=0;i<t.length;i++)t[i].resize()},200)}}(),window.Table=[],document.getTableById=function(t){let e=NaN,i=document.getElementById(t);return window.Table.forEach(function(t){t.element===i&&(e=t)}),e};